<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACME Corp Mock Platform</title>
    <link rel="icon" type="image/svg+xml" href="/acme-favicon.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
                    colors: {
                        navy: { DEFAULT: '#002244', 50: '#e6f0ff', 100: '#b3d1ff', 600: '#003366', 700: '#002244', 800: '#001a33', 900: '#00111f' },
                        teal: { DEFAULT: '#00b4d8', 50: '#e6f9fc', 100: '#b3eef7', 400: '#00c4eb', 500: '#00b4d8', 600: '#0096b4' }
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; }
        .tile-card { transition: all 0.15s ease; }
        .tile-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .key-input:focus { outline: none; box-shadow: 0 0 0 2px #00b4d8; }
        .fade-in { animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        .badge { font-variant-numeric: tabular-nums; }
    </style>
</head>
<body class="bg-zinc-50 min-h-screen">

    <!-- KEY ENTRY SCREEN -->
    <div id="key-screen" class="min-h-screen flex items-center justify-center px-4">
        <div class="w-full max-w-md">
            <div class="bg-white rounded-xl border border-zinc-200 p-8 shadow-sm">
                <div class="flex flex-col items-center mb-8">
                    <img src="/acme-logo.svg" alt="ACME Corp" class="h-12 mb-4">
                    <h1 class="text-xl font-semibold text-zinc-900">ACME Corp Mock Platform</h1>
                    <p class="text-sm text-zinc-500 mt-1">Enterprise API sandbox for automation workshops</p>
                </div>

                <div class="space-y-4">
                    <div>
                        <label for="api-key-input" class="block text-sm font-medium text-zinc-700 mb-1.5">API Key</label>
                        <input id="api-key-input" type="password" placeholder="Enter your API key"
                            class="key-input w-full px-3.5 py-2.5 rounded-lg border border-zinc-300 text-sm placeholder:text-zinc-400 bg-white">
                    </div>
                    <button id="unlock-btn" onclick="validateKey()"
                        class="w-full px-4 py-2.5 bg-navy-700 text-white rounded-lg text-sm font-medium hover:bg-navy-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        Unlock &rarr;
                    </button>
                    <div id="key-error" class="hidden text-sm text-red-600 text-center"></div>
                </div>

                <div class="mt-6 pt-5 border-t border-zinc-100">
                    <p class="text-xs text-zinc-400 text-center leading-relaxed">
                        Get your key from <strong class="text-zinc-500">1Password</strong>: ACME Mock Platform - API Key
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- PORTAL SCREEN -->
    <div id="portal-screen" class="hidden">
        <!-- Header -->
        <header class="bg-white border-b border-zinc-200 sticky top-0 z-10">
            <div class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <img src="/acme-logo.svg" alt="ACME Corp" class="h-8">
                    <div>
                        <h1 class="text-base font-semibold text-zinc-900 leading-tight">ACME Corp Mock Platform</h1>
                        <p class="text-xs text-zinc-400">Enterprise API Sandbox</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div id="status-indicator" class="flex items-center gap-1.5">
                        <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
                        <span class="text-xs text-zinc-500">Online</span>
                    </div>
                    <button onclick="changeKey()" class="text-xs text-zinc-400 hover:text-zinc-600 transition-colors">Change Key</button>
                </div>
            </div>
        </header>

        <main class="max-w-6xl mx-auto px-6 py-8 fade-in">
            <!-- Quick Start -->
            <section class="mb-10">
                <h2 class="text-sm font-semibold text-zinc-400 uppercase tracking-wider mb-4">Quick Start</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-white rounded-lg border border-zinc-200 p-5">
                        <div class="text-sm font-medium text-zinc-900 mb-1.5">What is this?</div>
                        <p class="text-xs text-zinc-500 leading-relaxed">A fully functional mock enterprise platform with 145+ REST API endpoints across 6 business domains. All data is in-memory and resets on restart.</p>
                    </div>
                    <div class="bg-white rounded-lg border border-zinc-200 p-5">
                        <div class="text-sm font-medium text-zinc-900 mb-1.5">Available Apps</div>
                        <p class="text-xs text-zinc-500 leading-relaxed">Use the ITSM Console to manage incidents, changes, and requests. The HR Portal simulates legacy form submission. The API Explorer lets you test any endpoint.</p>
                    </div>
                    <div class="bg-white rounded-lg border border-zinc-200 p-5">
                        <div class="text-sm font-medium text-zinc-900 mb-1.5">Using the API Key</div>
                        <p class="text-xs text-zinc-500 leading-relaxed">All API calls require the <code class="text-xs bg-zinc-100 px-1 py-0.5 rounded">x-api-key</code> header. Sub-apps inherit your key automatically via sessionStorage.</p>
                    </div>
                </div>
            </section>

            <!-- Applications -->
            <section class="mb-10">
                <h2 class="text-sm font-semibold text-zinc-400 uppercase tracking-wider mb-4">Applications</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- ITSM Console -->
                    <a href="/itsm-app/" class="tile-card bg-white rounded-lg border border-zinc-200 p-5 block no-underline group">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-teal-50 flex items-center justify-center">
                                    <svg class="w-5 h-5 text-teal-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0115 18.257V17.25m6-12V15a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 15V5.25A2.25 2.25 0 015.25 3h13.5A2.25 2.25 0 0121 5.25z" />
                                    </svg>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-zinc-900 group-hover:text-teal-600 transition-colors">ITSM Console</div>
                                    <div class="text-xs text-zinc-400">IT Service Management</div>
                                </div>
                            </div>
                            <span id="badge-incidents" class="badge hidden px-2 py-0.5 text-xs font-medium rounded-full bg-amber-50 text-amber-700 border border-amber-200"></span>
                        </div>
                        <p class="text-xs text-zinc-500 leading-relaxed">Manage incidents, problems, changes, service requests, assets, and knowledge articles.</p>
                        <div class="mt-3 text-xs font-medium text-teal-600 group-hover:text-teal-700">Launch &rarr;</div>
                    </a>

                    <!-- HR Portal -->
                    <a href="/legacy-portal/" class="tile-card bg-white rounded-lg border border-zinc-200 p-5 block no-underline group">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-indigo-50 flex items-center justify-center">
                                    <svg class="w-5 h-5 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
                                    </svg>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-zinc-900 group-hover:text-indigo-600 transition-colors">HR Portal</div>
                                    <div class="text-xs text-zinc-400">Legacy Onboarding System</div>
                                </div>
                            </div>
                            <span id="badge-workers" class="badge hidden px-2 py-0.5 text-xs font-medium rounded-full bg-indigo-50 text-indigo-700 border border-indigo-200"></span>
                        </div>
                        <p class="text-xs text-zinc-500 leading-relaxed">Simulated legacy HR onboarding portal for form-filling automation scenarios.</p>
                        <div class="mt-3 text-xs font-medium text-indigo-600 group-hover:text-indigo-700">Launch &rarr;</div>
                    </a>
                </div>
            </section>

            <!-- Developer Tools -->
            <section class="mb-10">
                <h2 class="text-sm font-semibold text-zinc-400 uppercase tracking-wider mb-4">Developer Tools</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- API Explorer -->
                    <a href="/explorer/" class="tile-card bg-white rounded-lg border border-zinc-200 p-5 block no-underline group">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-emerald-50 flex items-center justify-center">
                                    <svg class="w-5 h-5 text-emerald-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5" />
                                    </svg>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-zinc-900 group-hover:text-emerald-600 transition-colors">API Explorer</div>
                                    <div class="text-xs text-zinc-400">Interactive Testing</div>
                                </div>
                            </div>
                            <span id="badge-endpoints" class="badge hidden px-2 py-0.5 text-xs font-medium rounded-full bg-emerald-50 text-emerald-700 border border-emerald-200"></span>
                        </div>
                        <p class="text-xs text-zinc-500 leading-relaxed">Browse and test all 145+ API endpoints interactively with live request/response views.</p>
                        <div class="mt-3 text-xs font-medium text-emerald-600 group-hover:text-emerald-700">Launch &rarr;</div>
                    </a>

                    <!-- API Documentation -->
                    <a href="/api-documentation.html" class="tile-card bg-white rounded-lg border border-zinc-200 p-5 block no-underline group">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-zinc-100 flex items-center justify-center">
                                    <svg class="w-5 h-5 text-zinc-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
                                    </svg>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-zinc-900 group-hover:text-zinc-700 transition-colors">API Documentation</div>
                                    <div class="text-xs text-zinc-400">Reference Guide</div>
                                </div>
                            </div>
                            <span id="badge-collections" class="badge hidden px-2 py-0.5 text-xs font-medium rounded-full bg-zinc-100 text-zinc-600 border border-zinc-200"></span>
                        </div>
                        <p class="text-xs text-zinc-500 leading-relaxed">Complete API reference with endpoint schemas, example payloads, and usage tips.</p>
                        <div class="mt-3 text-xs font-medium text-zinc-500 group-hover:text-zinc-700">Launch &rarr;</div>
                    </a>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="border-t border-zinc-200 bg-white">
            <div class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
                <div class="text-xs text-zinc-400">
                    <span id="footer-stats"></span>
                </div>
                <button onclick="changeKey()" class="text-xs text-zinc-400 hover:text-zinc-600 transition-colors">Change API Key</button>
            </div>
        </footer>
    </div>

    <script>
        const KEY_NAME = 'acme_api_key';

        // On load: check for existing key
        (async function init() {
            const key = sessionStorage.getItem(KEY_NAME);
            if (key) {
                const valid = await testKey(key);
                if (valid) return showPortal();
            }
            showKeyScreen();
        })();

        function showKeyScreen() {
            document.getElementById('key-screen').classList.remove('hidden');
            document.getElementById('portal-screen').classList.add('hidden');
            document.getElementById('key-error').classList.add('hidden');
            const input = document.getElementById('api-key-input');
            input.value = '';
            setTimeout(() => input.focus(), 100);
        }

        function showPortal() {
            document.getElementById('key-screen').classList.add('hidden');
            document.getElementById('portal-screen').classList.remove('hidden');
            loadStats();
        }

        async function testKey(key) {
            try {
                const res = await fetch('/api/portal/stats', { headers: { 'x-api-key': key } });
                return res.ok;
            } catch { return false; }
        }

        async function validateKey() {
            const input = document.getElementById('api-key-input');
            const btn = document.getElementById('unlock-btn');
            const errEl = document.getElementById('key-error');
            const key = input.value.trim();

            if (!key) {
                errEl.textContent = 'Please enter an API key';
                errEl.classList.remove('hidden');
                return;
            }

            btn.disabled = true;
            btn.textContent = 'Validating...';
            errEl.classList.add('hidden');

            const valid = await testKey(key);
            if (valid) {
                sessionStorage.setItem(KEY_NAME, key);
                showPortal();
            } else {
                errEl.textContent = 'Invalid API key. Check your key and try again.';
                errEl.classList.remove('hidden');
            }
            btn.disabled = false;
            btn.textContent = 'Unlock \u2192';
        }

        function changeKey() {
            sessionStorage.removeItem(KEY_NAME);
            showKeyScreen();
        }

        async function loadStats() {
            const key = sessionStorage.getItem(KEY_NAME);
            try {
                const res = await fetch('/api/portal/stats', { headers: { 'x-api-key': key } });
                if (!res.ok) return;
                const stats = await res.json();

                setBadge('badge-incidents', stats.openIncidents + ' open');
                setBadge('badge-workers', stats.workerCount + ' workers');
                setBadge('badge-endpoints', stats.endpointCount + ' routes');
                setBadge('badge-collections', stats.collectionCount + ' collections');

                document.getElementById('footer-stats').textContent =
                    stats.collectionCount + ' collections \u00b7 ' + stats.endpointCount + ' routes \u00b7 All data in-memory';
            } catch { /* silently fail */ }
        }

        function setBadge(id, text) {
            const el = document.getElementById(id);
            if (el) { el.textContent = text; el.classList.remove('hidden'); }
        }

        // Enter key submits
        document.getElementById('api-key-input').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') validateKey();
        });
    </script>
</body>
</html>
